import{r as e,j as t}from"./vendor-D80FRCUd.js";import{c as a}from"./database-C7DZEwQH.js";import{u as i,a as s,m as l,A as r}from"./framer-motion-BcwsrWN3.js";import.meta;let n;n="postgresql://neondb_owner:npg_BIpmCq67lMrb@ep-quiet-pine-aefsvs3p-pooler.c-2.us-east-2.aws.neon.tech/neondb?channel_binding=require&sslmode=require";const o=a(n),c=new Map,d=async()=>{try{const e=[{name:"爱心",image_url:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNMjU2IDE3NmMzMy4xIDAgNjAtMjYuOSA2MC02MHMtMjYuOS02MC02MC02MC02MCAyNi45LTYwIDYwIDI2LjkgNjAgNjAgNjB6Ii8+PC9zdmc+"},{name:"祝福",image_url:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNMjU2IDI1NmMxMS4wNSAwIDIwLTguOTUgMjAtMjBzLTguOTUtMjAtMjAtMjAtMjAgOC45NS0yMCAyMCA4Ljk1IDIwIDIwIDIweiIvPjwvc3ZnPg=="},{name:"星星",image_url:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNNDI3IDI1Nmw2My42NCAzNi43My0yNi41NiA3OS4xMy03OS4xMy0yNi41Ni0xLjgxIDkyLjE0LTc3LjMyLTE5Ljc4LTQzLjQ1IDU4LjQ4LTk0Ljc3LTEwLjY2LTgwLjQ0LTY2LjU2IDY0LjEyLTU0LjE5IDkxLjI0IDQ4LjIzIDY3LjI3LTEwOS45MyA0My40NS01OC40OCA2Ni41Ni0xMTIuMjkgNi4xMi05Ni40NCA2NC4xMi0xOC4wOSAxMDIuOTQtNjQuMTIgNTkuMTIgNDkuMzMgNjQuMTIgMTI0LjU0LTEwLjY2IDkyLjE0IDkwLjE0IDgwLjQ0IDY0LjEyIDgwLjQ0LTYyLjI3LTc3LjMyLTE5Ljc4LTEwMS40MyA0OC40OC0xMTIuMjkgNDguNDgtMTQuOTYgMC00My40NS00OC40OC00My40NS00OC40OFYyMDZjMC0yNy42MiAyMi4zOC01MCA1MC01MHM1MCAyMi4zOCA1MCA1MC0yMi4zOCA1MC01MCA1MCIvPjwvc3ZnPg=="},{name:"气球",image_url:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNMjU2IDE0NGMxMS4wNSAwIDIwLTguOTUgMjAtMjBzLTguOTUtMjAtMjAtMjAtMjAgOC45NS0yMCAyMCA4Ljk1IDIwIDIwIDIweiIvPjxwYXRoIGQ9Ik0yNTYgMTI0Yy0yNS40MSAwLTQ2IDIwLjU5LTQ2IDQ2czIwLjU5IDQ2IDQ2IDQ2IDQ2LTIwLjU5IDQ2LTQ2LTIwLjU5LTQ2LTQ2LTQ2em0wLTEyYzI3LjYyIDAgNTAtMjIuMzggNTAtNTBTMjgzLjYyIDAgMjU2IDAgMjA2IDIyLjM4IDIwNiA1MCA1MCA1MCA1MC0yMi4zOCA1MC01MHoiLz48L3N2Zz4="},{name:"烟花",image_url:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNNDI3IDI1NmwtMTEuMzEgMTkuNTctOS4yOS0yMS43Ny0yMS43Ny05LjI5IDIxLjc3LTkuMjkgOS4yOS0yMS43Ny05LjI5IDIxLjc3IDIxLjc3IDkuMjktOS4yOSAyMS43Ny05LjI5IDkuMjkgMjEuNzcgOS4yOXptLTE3MS00NmwxOS41Ny0xMS4zMS0yMS43Ny05LjI5LTkuMjkgMjEuNzcgMjEuNzcgOS4yOS05LjI5IDIxLjc3IDIxLjc3IDkuMjktMjEuNzcgOS4yOXpNMjU2IDE3M2wxOS41Ny0xMS4zMS0yMS43Ny05LjI5LTkuMjkgMjEuNzcgMjEuNzcgOS4yOS05LjI5IDIxLjc3IDIxLjc3IDkuMjktMjEuNzcgOS4yOXptMCAxNzZsMTkuNTctMTEuMzEtMjEuNzctOS4yOS05LjI5IDIxLjc3IDIxLjc3IDkuMjktOS4yOSAyMS43NyAyMS43NyA5LjI5LTIxLjc3IDkuMjl6TTQyNyAzMzRsLTExLjMxIDE5LjU3LTkuMjktMjEuNzctMjEuNzctOS4yOSAyMS43Ny05LjI5IDkuMjktMjEuNzctOS4yOSAyMS43NyAyMS43NyA5LjI5LTkuMjkgMjEuNzctOS4yOSA5LjI5IDIxLjc3IDkuMjl6Ii8+PC9zdmc+"}];for(const t of e)await(o`
        INSERT INTO sticker_pack (name, image_url)
        VALUES (${t.name}, ${t.image_url});
      `)}catch(e){}},u=async(e=!1)=>{const t="blessingsWithMedia";if(!e&&c.has(t)){const e=c.get(t);if(Date.now()-e.timestamp<3e5)return e.data}try{try{const e=await(o`
        SELECT b.id, b.name, b.message, b.avatar_url, b.photo_url, b.audio_url, b.sticker_id, b.created_at, 
               s.name as sticker_name, s.image_url as sticker_image_url
        FROM blessings b
        LEFT JOIN sticker_pack s ON b.sticker_id = s.id
        ORDER BY b.created_at DESC;
      `);return c.set(t,{data:e,timestamp:Date.now()}),e}catch(a){const e=(await(o`
        SELECT id, name, message, avatar_url, created_at, photo_url, audio_url
        FROM blessings 
        ORDER BY created_at DESC;
      `)).map(e=>({...e,sticker_id:null,sticker_name:null,sticker_image_url:null}));return c.set(t,{data:e,timestamp:Date.now()}),e}}catch(i){return[]}};function x({opacity:e=.1}){return t.jsxs(t.Fragment,{children:[t.jsx(l.svg,{className:"absolute left-10 top-10",width:"120",height:"60",style:{opacity:e},initial:{x:-20,opacity:0},animate:{x:0,opacity:e,y:[0,-5,0]},transition:{duration:1,y:{duration:6,repeat:1/0,ease:"easeInOut"}},children:t.jsx("ellipse",{cx:"60",cy:"30",rx:"60",ry:"30",fill:"#FFF8F5"})}),t.jsx(l.svg,{className:"absolute right-20 top-24",width:"100",height:"50",style:{opacity:e},initial:{x:20,opacity:0},animate:{x:0,opacity:e,y:[0,8,0]},transition:{duration:1.2,y:{duration:7,repeat:1/0,ease:"easeInOut"}},children:t.jsx("ellipse",{cx:"50",cy:"25",rx:"50",ry:"25",fill:"#FFF8F5"})}),t.jsx(l.svg,{className:"absolute left-1/3 bottom-10",width:"140",height:"70",style:{opacity:e},initial:{y:20,opacity:0},animate:{y:0,opacity:e,x:[0,10,0]},transition:{duration:1.5,x:{duration:8,repeat:1/0,ease:"easeInOut"}},children:t.jsx("ellipse",{cx:"70",cy:"35",rx:"70",ry:"35",fill:"#FFF8F5"})})]})}function m(){return t.jsxs(l.div,{className:"relative mx-auto mt-8 mb-12",initial:{y:60,opacity:0},animate:{y:0,opacity:1,scale:[.9,1.02,1]},transition:{duration:1,scale:{duration:.5,delay:.5}},style:{width:120,height:180},children:[t.jsx(l.div,{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 w-36 h-4 bg-black/20 rounded-full blur-md",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0}}),t.jsxs(l.svg,{width:"120",height:"180",viewBox:"0 0 120 180",animate:{boxShadow:["0 10px 30px rgba(184, 115, 51, 0.1)","0 15px 35px rgba(184, 115, 51, 0.2)","0 10px 30px rgba(184, 115, 51, 0.1)"]},transition:{duration:3,repeat:1/0},children:[t.jsx("ellipse",{cx:"60",cy:"30",rx:"50",ry:"20",children:t.jsx(l.animate,{attributeName:"fill",values:"#c99b57;#d4ad6f;#c99b57",dur:"5s",repeatCount:"indefinite"})}),t.jsx("rect",{x:"10",y:"30",width:"100",height:"120",rx:"20",children:t.jsx(l.animate,{attributeName:"fill",values:"#b87333;#c99b57;#b87333",dur:"5s",repeatCount:"indefinite"})}),t.jsx("ellipse",{cx:"60",cy:"150",rx:"50",ry:"20",children:t.jsx(l.animate,{attributeName:"fill",values:"#a05a2c;#b87333;#a05a2c",dur:"5s",repeatCount:"indefinite"})}),t.jsx("rect",{x:"35",y:"60",width:"50",height:"20",rx:"6",fill:"#fff"}),t.jsx("rect",{x:"45",y:"65",width:"30",height:"10",rx:"3",children:t.jsx(l.animate,{attributeName:"fill",values:"#b87333;#c99b57;#b87333",dur:"5s",repeatCount:"indefinite"})}),t.jsx(l.g,{initial:{opacity:0},animate:{opacity:[.3,1,.3]},transition:{duration:3,repeat:1/0},children:t.jsx("path",{d:"M60 30 L63 40 L75 40 L65 48 L68 60 L60 52 L52 60 L55 48 L45 40 L57 40 Z",fill:"#FFF5CC"})})]}),t.jsx(l.div,{className:"absolute left-1/2 top-16",style:{transform:"translate(-50%,0)"},animate:{y:[0,-30,0],opacity:[1,.7,1]},transition:{duration:2.5,repeat:1/0},children:t.jsxs("svg",{width:"40",height:"28",viewBox:"0 0 40 28",children:[t.jsx("rect",{x:"2",y:"4",width:"36",height:"20",rx:"4",fill:"#fff",stroke:"#b87333",strokeWidth:"2"}),t.jsx("polyline",{points:"2,4 20,18 38,4",fill:"none",stroke:"#b87333",strokeWidth:"2"}),t.jsx("path",{d:"M15 12 L18 12 L18 15 L15 15 Z",fill:"#f9c784"})]})}),t.jsx(l.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:[0,.4,0]},transition:{duration:2,repeat:1/0,delay:1},children:t.jsxs("svg",{width:"120",height:"180",viewBox:"0 0 120 180",children:[t.jsxs("linearGradient",{id:"shine",x1:"-50%",y1:"-50%",x2:"150%",y2:"150%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fff",stopOpacity:"0"}),t.jsx("stop",{offset:"50%",stopColor:"#fff",stopOpacity:"0.3"}),t.jsx("stop",{offset:"100%",stopColor:"#fff",stopOpacity:"0"})]}),t.jsx("ellipse",{cx:"60",cy:"30",rx:"50",ry:"20",fill:"url(#shine)"}),t.jsx("rect",{x:"10",y:"30",width:"100",height:"120",rx:"20",fill:"url(#shine)"})]})})]})}function h({b:e,onClick:a}){var i;const s=()=>{var t;const a=["#b87333","#f9c784","#F7D6E0","#BFC9FF","#A8C3A4"];return a[((null==(t=e.id)?void 0:t.length)+1)%a.length||0]};return t.jsxs(l.div,{className:"relative cursor-pointer group",whileHover:{scale:1.12,zIndex:10},whileTap:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},onClick:a,style:{width:60,height:42},children:[t.jsx(l.div,{className:"absolute inset-1 rounded-lg bg-black/10 blur-sm",animate:{opacity:[.4,.6,.4]},transition:{duration:3,repeat:1/0}}),t.jsxs("svg",{width:"60",height:"42",viewBox:"0 0 60 42",children:[t.jsx("rect",{x:"2",y:"6",width:"56",height:"30",rx:"7",fill:(()=>{var t;const a=["#fff","#FFF8F5","#FFF5CC","#F0F7FF","#F5FFF8"];return a[(null==(t=e.id)?void 0:t.length)%a.length||0]})(),stroke:s(),strokeWidth:"2"}),t.jsx("polyline",{points:"2,6 30,30 58,6",fill:"none",stroke:s(),strokeWidth:"2"}),t.jsx("circle",{cx:"30",cy:"20",r:"4",fill:`${s()}30`}),t.jsx("path",{d:"M25 20 L35 20 M30 15 L30 25",stroke:s(),strokeWidth:"1",strokeLinecap:"round"})]}),t.jsx(l.div,{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 rounded-full border-2 border-white flex items-center justify-center overflow-hidden shadow",style:{background:e.avatar_url?"transparent":`linear-gradient(135deg, ${s()}, ${s()}99)`},whileHover:{scale:1.2,rotate:5},children:e.avatar_url?t.jsx(l.img,{src:e.avatar_url,alt:"avatar",className:"w-full h-full object-cover",whileHover:{scale:1.1}}):t.jsx("span",{className:"text-lg text-white font-medium",children:(null==(i=e.name)?void 0:i[0])||"匿"})}),t.jsxs(l.div,{className:"absolute left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2 text-xs text-white bg-black/60 px-2 py-0.5 rounded shadow whitespace-nowrap",initial:{opacity:0,y:5},whileHover:{opacity:1,y:0},transition:{duration:.2},children:[e.message.slice(0,8),e.message.length>8?"...":""]}),t.jsx(l.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:[0,.2,0]},transition:{duration:2,repeat:1/0,delay:3*Math.random()},children:t.jsxs("svg",{width:"60",height:"42",viewBox:"0 0 60 42",children:[t.jsxs("linearGradient",{id:`shine-${e.id}`,x1:"-50%",y1:"-50%",x2:"150%",y2:"150%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fff",stopOpacity:"0"}),t.jsx("stop",{offset:"50%",stopColor:"#fff",stopOpacity:"0.3"}),t.jsx("stop",{offset:"100%",stopColor:"#fff",stopOpacity:"0"})]}),t.jsx("rect",{x:"2",y:"6",width:"56",height:"30",rx:"7",fill:`url(#shine-${e.id})`})]})})]})}function p({blessings:a}){const[i,s]=e.useState([]);return e.useEffect(()=>{const e=Array.from({length:12}).map((e,t)=>{var i,s;const l=["#ffffff","#f9c784","#F7D6E0","#BFC9FF"],r=1.5+1*Math.random(),n=10+20*Math.random(),o=.5+1*Math.random(),c=8+10*Math.random(),d=8+4*Math.random();return{id:t,left:5+90*Math.random(),delay:.1+.25*t,text:(null==(s=null==(i=a[t%a.length])?void 0:i.message)?void 0:s.slice(0,12))||"",color:l[Math.floor(Math.random()*l.length)],speed:r,length:n,thickness:o,size:c,textSize:d}});s(e);const t=setTimeout(()=>s([]),3500);return()=>clearTimeout(t)},[a]),i.length?t.jsxs("div",{className:"pointer-events-none fixed inset-0 w-full h-full z-50",children:[i.map(e=>t.jsxs(l.div,{className:"absolute",initial:{x:`${e.left}vw`,y:-50,opacity:0,rotate:-15},animate:{x:`${e.left+25}vw`,y:300,opacity:[0,1,.8,0],rotate:-15},transition:{duration:2.5/e.speed,delay:e.delay,ease:"easeOut"},children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(l.div,{className:"h-1 rounded-full",style:{width:`${e.length}px`,background:`linear-gradient(to right, ${e.color}, transparent)`,boxShadow:`0 0 ${5*e.thickness}px ${2*e.thickness}px ${e.color}80`},animate:{opacity:[1,.5,0]},transition:{duration:2/e.speed}}),t.jsx(l.div,{className:"rounded-full",style:{width:`${e.size}px`,height:`${e.size}px`,background:e.color,boxShadow:`0 0 ${e.size}px ${e.size/2}px ${e.color}80`},animate:{scale:[1,1.2,1],opacity:[1,.7,0]},transition:{duration:2/e.speed}})]}),t.jsx(l.div,{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 whitespace-nowrap",style:{fontSize:`${e.textSize}px`},initial:{opacity:0,y:10},animate:{opacity:[0,.9,.3,0],y:[10,0,5,15]},transition:{duration:2/e.speed,delay:e.delay+.2},children:t.jsx("span",{className:"text-white drop-shadow-lg font-cursive",children:e.text})}),[...Array(5)].map((a,i)=>t.jsx(l.div,{className:"absolute rounded-full bg-white",style:{width:`${.5+Math.random()}px`,height:`${.5+Math.random()}px`},initial:{x:Math.random()*e.length,opacity:.8,y:0},animate:{x:Math.random()*e.length,y:-10-20*Math.random(),opacity:[.8,0]},transition:{duration:1/e.speed,delay:e.delay+.5*Math.random()}},`particle-${e.id}-${i}`))]},e.id)),t.jsx(l.div,{className:"absolute inset-0 bg-[#F9C784]/5 pointer-events-none",initial:{opacity:0},animate:{opacity:[0,.5,0]},transition:{duration:3.5}})]}):null}function y(){var a;const[n,c]=e.useState(""),[y,j]=e.useState(""),[g,b]=e.useState([]),[f,M]=e.useState(!0),[N,w]=e.useState(!1),[I,v]=e.useState(null),[L,C]=e.useState(!1),[T,S]=e.useState(null),[k,A]=e.useState(null),[D,E]=e.useState(!1),F=e.useRef(null),O=e.useRef([]);e.useEffect(()=>{const e=[{id:"mock1",name:"匿名祝福者",message:"新婚快乐，百年好合！",created_at:(new Date).toISOString(),avatar_url:null,photo_url:null,audio_url:null,sticker_id:null,sticker_name:null,sticker_image_url:null},{id:"mock2",name:"亲友团",message:"永结同心，幸福美满！",created_at:new Date(Date.now()-36e5).toISOString(),avatar_url:null,photo_url:null,audio_url:null,sticker_id:null,sticker_name:null,sticker_image_url:null}];b(e);const t=localStorage.getItem("hasInitializedTables"),a=async()=>{try{const e=await u();e&&e.length>0&&b(e)}catch(e){}finally{M(!1)}};Promise.all([(async()=>{try{t||(await(async()=>{try{const e=(await(o`
      SELECT column_name 
      FROM information_schema.columns 
      WHERE table_name = 'blessings' 
        AND column_name IN ('photo_url', 'audio_url', 'sticker_id');
    `)).map(e=>e.column_name),t=[];if(e.includes("photo_url")||t.push("ADD COLUMN photo_url TEXT"),e.includes("audio_url")||t.push("ADD COLUMN audio_url TEXT"),e.includes("sticker_id")||t.push("ADD COLUMN sticker_id INTEGER"),t.length>0)for(const a of t)await(o`ALTER TABLE blessings ${a}`);(await(o`
      SELECT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_name = 'sticker_pack'
      );
    `))[0].exists||(await(o`
        CREATE TABLE sticker_pack (
          id SERIAL PRIMARY KEY,
          name VARCHAR(50) NOT NULL,
          image_url TEXT NOT NULL,
          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
      `),await d())}catch(e){}})(),localStorage.setItem("hasInitializedTables","true"))}catch(e){}})(),a()]);const i=setInterval(a,3e5);return()=>clearInterval(i)},[]),e.useEffect(()=>{const e=setTimeout(()=>C(!0),3e4);return()=>clearTimeout(e)},[]);e.useEffect(()=>()=>{T&&T.startsWith("blob:")&&URL.revokeObjectURL(T),k&&k.startsWith("blob:")&&URL.revokeObjectURL(k),F.current&&D&&F.current.stop()},[T,k,D]);const _=e=>{"photo"===e?S(null):"audio"===e&&A(null)},{scrollYProgress:z}=i(),B=s(z,[0,1],[0,-100]),R=s(z,[0,.5,1],[1,.7,.5]),[U,$]=e.useState([]);return e.useEffect(()=>{const e=Array.from({length:50}).map((e,t)=>({id:t,x:100*Math.random(),y:100*Math.random(),size:.5+2*Math.random(),opacity:.3+.7*Math.random(),delay:2*Math.random(),duration:2+3*Math.random()}));$(e)},[]),t.jsxs("div",{className:"relative min-h-[600px] bg-gradient-to-b from-[#0B0C2B] via-[#BFC9FF]/30 to-[#0B0C2B] rounded-3xl overflow-hidden shadow-xl py-12",children:[t.jsxs(l.div,{className:"absolute inset-0 pointer-events-none",style:{y:B,opacity:R},children:[U.map(e=>t.jsx(l.div,{className:"absolute rounded-full bg-white blur-sm",style:{left:`${e.x}%`,top:`${e.y}%`,width:`${e.size}px`,height:`${e.size}px`,opacity:e.opacity},animate:{opacity:[e.opacity,.5*e.opacity,e.opacity],scale:[1,1.2,1]},transition:{duration:e.duration,delay:e.delay,repeat:1/0,ease:"easeInOut"}},e.id)),t.jsx(l.div,{className:"absolute top-0 left-0 right-0 h-1/3 bg-[#F9C784]/10 blur-3xl",animate:{opacity:[.5,.8,.5]},transition:{duration:8,repeat:1/0}}),t.jsx(l.div,{className:"absolute bottom-0 left-0 right-0 h-1/3 bg-[#BFC9FF]/10 blur-3xl",animate:{opacity:[.5,.8,.5]},transition:{duration:8,repeat:1/0,delay:2}})]}),t.jsx(x,{opacity:.12}),L&&t.jsx(p,{blessings:g}),t.jsx(m,{}),t.jsx("div",{className:"relative flex flex-wrap justify-center gap-8 px-6 mt-2 min-h-[180px] transition-all duration-500",children:f?t.jsx(l.div,{className:"text-white/80 text-lg font-cursive",animate:{opacity:[.6,1,.6]},transition:{duration:2,repeat:1/0},children:"加载祝福中…"}):g.length>0?g.map((e,a)=>t.jsx(l.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,delay:.05*a},children:t.jsx(h,{b:e,onClick:()=>v(e)},e.id)},e.id)):t.jsxs(l.div,{className:"text-white/80 text-center p-8 max-w-md",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[t.jsx("div",{className:"text-4xl mb-4",children:"💌"}),t.jsx("div",{className:"text-lg font-cursive mb-2",children:"暂无祝福哦~"}),t.jsx("div",{className:"text-sm opacity-80",children:"成为第一个写下祝福的人吧！"})]})}),t.jsxs(l.button,{className:"fixed md:absolute right-4 md:right-8 bottom-4 md:bottom-8 z-30 bg-[#A8C3A4] hover:bg-[#F9C784] text-[#0B0C2B] rounded-full shadow-lg px-4 md:px-6 py-2 md:py-3 font-cursive text-base md:text-lg transition-all duration-300",onClick:()=>w(!0),whileHover:{scale:1.05,boxShadow:"0 10px 25px -5px rgba(168, 195, 164, 0.5)",rotate:2},whileTap:{scale:.98},initial:{opacity:0,y:20},animate:{opacity:1,y:0,boxShadow:["0 4px 10px rgba(168, 195, 164, 0.3)","0 6px 15px rgba(168, 195, 164, 0.4)","0 4px 10px rgba(168, 195, 164, 0.3)"]},transition:{duration:.5,boxShadow:{duration:3,repeat:1/0}},children:[t.jsx("span",{className:"hidden md:inline",children:"写一封新的祝福"}),t.jsx("span",{className:"md:hidden",children:"写祝福"}),t.jsx(l.span,{className:"inline-block ml-1 md:ml-2",animate:{rotate:[0,15,0,-15,0]},transition:{duration:2,repeat:1/0},children:"✨"})]}),t.jsx(r,{children:I&&t.jsx(l.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsxs(l.div,{className:"bg-[#FFF8F5]/95 rounded-2xl shadow-2xl p-8 max-w-lg w-full relative flex flex-col md:flex-row gap-6",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},children:[t.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[t.jsx("div",{className:"w-16 h-16 rounded-full bg-[#BFC9FF] border-2 border-white flex items-center justify-center overflow-hidden shadow mb-2",children:I.avatar_url?t.jsx("img",{src:I.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):t.jsx("span",{className:"text-lg text-white",children:(null==(a=I.name)?void 0:a[0])||"匿"})}),t.jsx("div",{className:"font-cursive text-lg text-[#b87333] mb-2",children:I.name||"匿名"}),t.jsx("div",{className:"text-xs text-gray-400",children:new Date(I.created_at).toLocaleString()})]}),t.jsxs("div",{className:"flex-[2] flex flex-col gap-4",children:[t.jsx("div",{className:"text-[#0B0C2B] font-inter text-base whitespace-pre-line leading-relaxed border-l-2 border-[#F7D6E0]/40 pl-6 space-y-3",children:I.message}),t.jsxs("div",{className:"space-y-4",children:[I.photo_url&&t.jsx("div",{className:"rounded-xl overflow-hidden border-2 border-[#BFC9FF]",children:t.jsx("img",{src:I.photo_url,alt:"祝福照片",className:"w-full h-auto object-contain max-h-64",loading:"lazy"})}),I.audio_url&&t.jsxs("div",{className:"bg-[#F7D6E0]/20 p-3 rounded-xl",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2 font-cursive",children:"语音祝福："}),t.jsx("audio",{controls:!0,src:I.audio_url,className:"w-full"})]})]})]}),t.jsx(l.button,{className:"absolute right-4 top-4 text-2xl text-[#b87333] hover:text-[#F9C784]",onClick:()=>v(null),whileHover:{scale:1.2,rotate:90},whileTap:{scale:.9},transition:{duration:.2},children:"✕"})]})})}),t.jsx(r,{children:N&&t.jsx(l.div,{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center bg-black/40 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsxs(l.form,{onSubmit:async e=>{e.preventDefault();const t=y.trim();if(t)try{M(!0),await(async(e,t,a=null,i=null,s=null)=>{try{if(null!=s)try{return(await(o`
          INSERT INTO blessings (name, message, avatar_url, photo_url, audio_url, sticker_id)
          VALUES (
            ${e.trim().slice(0,20)||"匿名"},
            ${t.trim().slice(0,240)},
            ${""},
            ${a},
            ${i},
            ${s}
          )
          RETURNING id;
        `))[0].id}catch(l){}return(await(o`
      INSERT INTO blessings (name, message, avatar_url, photo_url, audio_url)
      VALUES (
        ${e.trim().slice(0,20)||"匿名"},
        ${t.trim().slice(0,240)},
        ${""},
        ${a},
        ${i}
      )
      RETURNING id;
    `))[0].id}catch(r){throw r}})(n,t,T,k),c(""),j(""),S(null),A(null),w(!1);const e=await u();b(e),C(!0),setTimeout(()=>C(!1),3200)}catch(a){alert(`提交失败: ${a.message}`)}finally{M(!1)}},className:"bg-[#FFF8F5]/95 rounded-t-2xl md:rounded-2xl shadow-2xl p-8 w-full max-w-lg flex flex-col gap-4",initial:{y:80},animate:{y:0},exit:{y:80},children:[t.jsx("div",{className:"flex gap-2",children:t.jsx("input",{className:"flex-1 px-4 py-3 rounded-xl border border-gray-200 font-cursive",placeholder:"你的名字（可留空）",value:n,onChange:e=>c(e.target.value)})}),t.jsx("textarea",{className:"w-full mt-1 px-4 py-3 rounded-xl border border-gray-200 font-inter",rows:3,placeholder:"写下你的祝福（最多 240 字）",value:y,onChange:e=>j(e.target.value)}),t.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(t)try{if(t.size>5242880)return void alert("文件过大，请选择小于5MB的图片");M(!0);const e=URL.createObjectURL(t);S(e);const a=await(async e=>{try{return new Promise(t=>{const a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsDataURL(e)})}catch(t){throw t}})(t);S(a)}catch(a){alert("上传照片失败，请重试"),S(null)}finally{M(!1),e.target.value=""}},className:"hidden",id:"photo-upload"}),t.jsxs("div",{className:"mt-2 space-y-2",children:[T&&t.jsxs("div",{className:"relative w-full max-h-48 rounded-xl overflow-hidden border-2 border-[#BFC9FF]",children:[t.jsx("img",{src:T,alt:"预览",className:"w-full h-full object-contain"}),t.jsx("button",{className:"absolute top-2 right-2 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center",onClick:()=>_("photo"),children:"✕"})]}),k&&t.jsxs("div",{className:"relative flex items-center gap-2 p-2 bg-[#F7D6E0]/20 rounded-xl",children:[t.jsx("audio",{controls:!0,src:k,className:"w-full"}),t.jsx("button",{className:"w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center flex-shrink-0",onClick:()=>_("audio"),children:"✕"})]})]}),t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsxs(l.label,{htmlFor:"photo-upload",className:"px-4 py-2 rounded-xl bg-[#BFC9FF] text-white font-cursive cursor-pointer hover:bg-opacity-90 transition",whileHover:{scale:1.03,boxShadow:"0 4px 12px rgba(191, 201, 255, 0.5)"},whileTap:{scale:.98},children:[t.jsx("span",{className:"inline-block mr-1",children:"🖼️"}),"上传照片"]}),D?t.jsxs(l.button,{type:"button",className:"px-4 py-2 rounded-xl bg-[#ff6b6b] text-white font-cursive hover:bg-opacity-90 transition",onClick:()=>{F.current&&D&&(F.current.stop(),E(!1))},whileHover:{scale:1.03,boxShadow:"0 4px 12px rgba(255, 107, 107, 0.5)"},whileTap:{scale:.98},children:[t.jsx("span",{className:"inline-block mr-1 animate-pulse",children:"🔴"}),"停止录音"]}):t.jsxs(l.button,{type:"button",className:"px-4 py-2 rounded-xl bg-[#F9C784] text-white font-cursive hover:bg-opacity-90 transition",onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);O.current=[],F.current=t,t.ondataavailable=e=>{e.data.size>0&&O.current.push(e.data)},t.onstop=async()=>{const t=new Blob(O.current,{type:"audio/wav"});try{const e=URL.createObjectURL(t);A(e);const a=await(async e=>{try{return new Promise(t=>{const a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsDataURL(e)})}catch(t){throw t}})(t);A(a)}catch(a){alert("上传录音失败，请重试"),A(null)}e.getTracks().forEach(e=>e.stop())},t.start(),E(!0)}catch(e){alert("请授予麦克风权限并确保设备正常")}},whileHover:{scale:1.03,boxShadow:"0 4px 12px rgba(249, 199, 132, 0.5)"},whileTap:{scale:.98},children:[t.jsx("span",{className:"inline-block mr-1",children:"🎤"}),"录制语音"]})]}),t.jsxs("div",{className:"flex justify-end mt-4 gap-4",children:[t.jsx(l.button,{type:"button",className:"px-4 py-2 rounded-xl bg-gray-200 text-gray-600 font-cursive",onClick:()=>w(!1),whileHover:{scale:1.03,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:"取消"}),t.jsxs(l.button,{type:"submit",className:"px-6 py-2 rounded-xl bg-[#A8C3A4] text-[#0B0C2B] font-cursive",whileHover:{scale:1.03,backgroundColor:"#F9C784",boxShadow:"0 4px 12px rgba(168, 195, 164, 0.5)"},whileTap:{scale:.98},children:[t.jsx("span",{className:"inline-block mr-1",children:"💌"}),"寄出祝福"]})]})]})})}),t.jsx(l.div,{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-[#F9C784] via-[#BFC9FF] to-[#A8C3A4]",animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"],opacity:[.7,1,.7]},transition:{duration:8,repeat:1/0,ease:"linear"}})]})}export{y as default};
